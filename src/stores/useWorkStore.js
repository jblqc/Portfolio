import{defineStore}from"pinia";import{supabase}from"@/lib/supabase";const SUPABASE_STORAGE_URL=import.meta.env.VITE_SUPABASE_STORAGE_URL,PROJECT_IMAGES_BASE=`${SUPABASE_STORAGE_URL}/project-image/project-specific/`;export const useWorkStore=defineStore("work",{state:()=>({categories:[],projects:[],workSpecific:[],projectImages:{},loading:!1,loaded:!1}),actions:{async fetchCategories(){const{data:e,error:t}=await supabase.from("categories").select("*");t||(this.categories=e??[])},async fetchProjects(){const{data:e,error:t}=await supabase.from("projects").select("*").order("id",{ascending:!0});t||(this.projects=(e??[]).map((e=>({...e,image:e.image?.startsWith("http")?e.image:`${SUPABASE_STORAGE_URL}/specific-project-logo/${e.image}`}))))},async fetchWorkSpecific(){const{data:e,error:t}=await supabase.from("work_specific").select("*").order("id",{ascending:!0});t||(this.workSpecific=e??[])},async fetchProjectImages(){const{data:e,error:t}=await supabase.from("project_images").select("project_id, image").order("project_id",{ascending:!0});if(t)return;const a={};for(const t of e??[]){const e=t.project_id,i=(Array.isArray(t.image)?t.image:[]).filter(Boolean).map((e=>e.startsWith("http")?e:`${PROJECT_IMAGES_BASE}${e}`));a[e]||(a[e]=[]),a[e].push(...i)}this.projectImages=a},async fetchAllData(){if(!this.loaded){this.loading=!0;try{await Promise.all([this.fetchCategories(),this.fetchProjects(),this.fetchWorkSpecific(),this.fetchProjectImages()]),this.loaded=!0}finally{this.loading=!1}}}}});